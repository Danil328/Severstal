MAIN:
  path_to_project: "/home/danil.akhmetov/Projects/Severstal/"
  path_to_data: "/home/danil.akhmetov/Projects/Severstal/data/"
  activation: &activation "sigmoid"
  fold: 7
TRAIN:
  batch_size: 32

  model: &model models.segmentation_models_pytorch_danil.FPN
  model_params: &model_params
    classes: 4
    encoder_weights: imagenet
    encoder_name: efficientnet-b5
    dropout: 0.2
#    attention_type: scse
    cls_out: 0
    hypercolumn: 'false'
    attentionGate: 'true'
    activation: *activation

  train_params:
    name: &name smp_fpn_efb5_crop_bce_H_fold_7
    type: crop
    model: *model
    model_params: *model_params
    loss: losses.ComboSuperVisionLoss
    loss_params:
      weights:
        bce: 3
        dice: 1
      sv_weight: 0.01
      activation: *activation
    metrics:
      metrics.HardDiceCoef:
        threshold: 0.5
      metrics.SoftDiceCoef:
        class_id: -1
#      metrics.SoftMaxDiceMetric:
#        threshold: 0.5

  stages:
#    freeze:
#      optimizer: optimizer.RAdam
#      optimizer_params:
#        lr: 0.001
#        weight_decay: 0.00001
#      scheduler: CosineAnnealingLR
#      scheduler_params:
#        T_max: 5
#        eta_min: 0.0001
#      epochs: 10
    warmup:
      optimizer: optimizer.RAdam
      optimizer_params:
        lr: 0.0001
        weight_decay: 0.00001
      scheduler: optimizer.GradualWarmupScheduler
      scheduler_params:
        multiplier: 8
        total_epoch: 10
      epochs: 10

    cosine:
      optimizer: optimizer.RAdam
      optimizer_params:
        lr: 0.0001
        weight_decay: 0.00001
      scheduler: CosineAnnealingLR
      scheduler_params:
        T_max: 10
        eta_min: 0.000001
      epochs: 160

    sgd:
      optimizer: SGD
      optimizer_params:
        lr: 0.0001
        weight_decay: 0.00001
      scheduler: CosineAnnealingLR
      scheduler_params:
        T_max: 10
        eta_min: 0.000001
      epochs: 50

  swa: 0
  data_params:
    empty_mask_increase:
      state: "true"
      start_value: 0.05
      end_value: 1.0
      n_epochs: 50

  dumps:
    metric_name: HardDiceCoef
    path: /home/danil.akhmetov/Projects/Severstal/output/
    weights: weights_cv
    logs: logs_cv

TEST:
  name: *name
  type: crop
  # type: full
  batch_size: 64
  model: *model
  model_params: *model_params
  weights: /home/danil.akhmetov/Projects/Severstal/output/weights_cv
  cls_predict: '../multilabel_lb_xception_096.csv'
  TTA: 'true'
  channel_threshold: "true"

#'../resnet34-cls-tta-0.50.csv'
#'../classification_lb_xception_098.csv'


